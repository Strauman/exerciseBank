%!TEX root = main.tex
% This file contains \At-commands that are responsible for formatting
% exercise headers and exercise-related styles.
\makeatletter
\newlength{\ppLeading}
\newlength{\pMarginBelow}
\newlength{\pMarginAbove}
\newlength{\pMarginLeft}
\newlength{\ppMarginBelow}
\newlength{\ppMarginAbove}
\newlength{\ppMargin}
\newlength{\ppPullback}

\setlength{\ppLeading}{4em}
\setlength{\pMarginBelow}{1em}
\setlength{\pMarginAbove}{1em}
\setlength{\pMarginLeft}{-1.5em}
\setlength{\ppMarginBelow}{2em}
\setlength{\ppMarginAbove}{2em}
\setlength{\ppMargin}{2em}

\setlength{\ppPullback}{3.5em}
\def\solMargin{\dimexpr \ppMargin\relax}
\def\vsSize{1em}
\def\vs{\vspace{\vsSize}}
%:Â§count
%:\!docCounter{problemcounter}-counter holds the current problem number and
%:\!docCounter{partproblemcounter}-counter holds the current partproblem \!emph{number}.
%:-
\newcounter{problemcounter}
\setcounter{problemcounter}{0}
\newcounter{partproblemcounter}

\At\VeryBeginProblem{
	\stepcounter{problemcounter}
	\setcounter{partproblemcounter}{1}
	\vspace*{\pMarginAbove}
	\begin{addmargin}{\pMarginLeft}
		{\normalfont\Large\bfseries\@tr{Problem}~\theproblemcounter}
	\end{addmargin}
	\vspace*{\pMarginBelow}
}
\At\EndProblem{
	\filbreak
}
\At\VeryBeginPartproblem{%
	\stepcounter{partproblemcounter}%
	\def\@pproblemHead{\large\textbf{(\theproblemcounter\alph{partproblemcounter})}}
	\begin{addmargin}{\ppMargin}
		\filbreak
		\begin{itemize}
			\item[\@pproblemHead]
}
\At\EndPartproblem{
		\end{itemize}
	\end{addmargin}
	\vspace*{\pMarginBelow}%
}

\At\BeginSolution{
	% \@pens\@lowpenalty
	\vspace*{1em}
	\def\@solutionHead{\large{\textbf{\@tr{Solution}:}}}
	\begin{addmargin}{\solMargin}
		\begin{itemize}
			\item[\@solutionHead]
}
\At\EndSolution{
		\end{itemize}
	\end{addmargin}
}
