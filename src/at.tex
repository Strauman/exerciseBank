%!TEX root = main.tex
% This file contains definitions of the \At and \Trigger command

%:§ref
\makeatletter
%% Adds macro to queue
\let\ea = \expandafter
\def\removebs#1{\if#1\@backslashchar\else#1\fi}
%:This package also includes some extra stuff. For example the \At and \Trigger
%:=\At{AnyMacro}
%:Here you can send any macro because it isn't evaluated! For example \At\BeginSomething is fine and even if \BeginSomething is not defined. Also and when using \Trigger it just ignores it if it didn't exist. It's pretty similar in function as to \AtBeginDocument.
%:! \At\BeginSomething{DoSomething}
%:! Which is triggered with
%:! \Trigger\BeginSomething, this evaluates to DoSomething
%:-
%% Usage: \At\BeginSomething (\BeginSomething) doesn't have to be defined
\newcommand{\At}[2]{
  \def\macname{\expandafter\removebs\detokenize{#1}}
  \let\mname = \macname
  \ifcsname At@\mname\endcsname
    \ea\g@addto@macro\csname At@\mname\endcsname{#2}
  \else
    \ea\gdef\csname At@\mname\endcsname{#2}
  \fi
}
%% Triggers queue generated by \At
%% Usage: \Trigger\BeginSomething (\BeginSomething) doesn't have to be defined
%:§triggers=Triggers
%:=\Trigger{Any Macro}
%: See \refCom{At}\\
%: Available triggers:\\
%:$$triggers
%:-
\newcommand{\Trigger}[1]{
  \def\macname{\expandafter\removebs\detokenize{#1}}
  \let\mname = \macname
  \@ifundefined{At@\mname}{}{\csname At@\mname\endcsname}
  % \ifcsname At@\mname\endcsname
  %   % \begingroup
  %   \makeatletter
  %   \csname At@\mname\endcsname
  %   \makeatother
  %   % \endgroup
  % \fi
}
\makeatother
